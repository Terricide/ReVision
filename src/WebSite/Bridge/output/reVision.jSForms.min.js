(function(){"use strict";Bridge.define("ReVision.JSForms.App",{statics:{config:{init:function(){Bridge.ready(this.main)}},main:function(){var app=new ReVision.JSForms.Application}}});Bridge.define("ReVision.JSForms.Application",{ws:null,controls:null,config:{init:function(){this.controls=new Bridge.Dictionary$2(String,System.Windows.Forms.Control)()}},constructor:function(){var path="",data;Bridge.hasValue(window.location.pathName)?(path=window.location.pathName.substr(0,Bridge.String.indexOf(window.location.pathName,String.fromCharCode(47),1)),window.location.port.length>1&&(path=":"+window.location.port+path)):path="ws://localhost:56357/echo";data="";Bridge.hasValue(window.sessionStorage)?(data=Bridge.as(window.sessionStorage.getItem("sessionId"),String),Bridge.hasValue(data)||(data=Bridge.get(System.Guid).newGuid(),window.sessionStorage.setItem("sessionId",data))):data=Bridge.get(System.Guid).newGuid();this.ws=new WebSocket(path+"?id="+data);this.ws.onopen=Bridge.fn.combine(this.ws.onopen,Bridge.fn.bind(this,this.onSocketOpen));this.ws.onmessage=Bridge.fn.combine(this.ws.onmessage,Bridge.fn.bind(this,this.onMessage));this.ws.onclose=Bridge.fn.combine(this.ws.onclose,Bridge.fn.bind(this,this.onClose));this.ws.onerror=Bridge.fn.combine(this.ws.onerror,Bridge.fn.bind(this,this.onError))},onError:function(){window.alert("Error")},onClose:function(){},onMessage:function(arg){var evt=Bridge.merge(new System.Windows.Forms.WSEventArgs,JSON.parse(arg.data.toString())),form,parent;switch(evt.eventType){case"MessageBox":window.alert(evt.value.toString());break;case"PropertyChanged":case"addListViewItem":case"addListItem":case"removeListViewItem":case"removeListItem":case"addListViewColumn":case"removeListViewColumn":case"clearList":break;case"removeControl":break;case"addControl":break;case"FormCreate":form=Bridge.merge(new System.Windows.Forms.Form,JSON.parse(JSON.stringify(evt.value)));form.setClientId(evt.clientId);parent=form.getParent();Bridge.hasValue(parent)||document.body.appendChild(form.element);this.addOrUpdate(form);form.showDialog();break;default:window.alert("Unknown message type:"+evt.eventType)}},addOrUpdate:function(ctrl){!Bridge.String.isNullOrEmpty(ctrl.getParentId())&&this.controls.containsKey(ctrl.getParentId())&&ctrl.setParent(this.controls.get(ctrl.getParentId()));this.controls.containsKey(ctrl.getClientId())?this.controls.set(ctrl.getClientId(),ctrl):this.controls.add(ctrl.getClientId(),ctrl)},onSocketOpen:function(){var args=new System.Windows.Forms.WSEventArgs;args.eventType="openForm";this.send(args)},send:function(o){var msg=JSON.stringify(o);this.ws.send(msg)}});Bridge.init()})(this);