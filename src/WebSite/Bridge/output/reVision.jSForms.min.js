(function(){"use strict";Bridge.define("ReVision.JSForms.App",{statics:{config:{init:function(){Bridge.ready(this.main)}},main:function(){var app=new ReVision.JSForms.Application}}});Bridge.define("ReVision.JSForms.Application",{statics:{current:null},ws:null,root:null,controls:null,config:{init:function(){this.controls=new Bridge.Dictionary$2(String,System.Windows.Forms.Control)()}},constructor:function(){var path,data;ReVision.JSForms.Application.current=this;path="";Bridge.hasValue(window.location.pathname)?(path=window.location.pathname.substr(0,Bridge.String.indexOf(window.location.pathname,String.fromCharCode(47),1)),window.location.port.length>1&&(path=":"+window.location.port+path)):path="ws://localhost:56357/echo";data="";Bridge.hasValue(window.sessionStorage)?(data=Bridge.as(window.sessionStorage.getItem("sessionId"),String),Bridge.hasValue(data)||(data=System.Guid.newGuid(),window.sessionStorage.setItem("sessionId",data))):data=System.Guid.newGuid();this.ws=new WebSocket(path+"?id="+data);this.ws.onopen=Bridge.fn.bind(this,this.onSocketOpen);this.ws.onmessage=Bridge.fn.bind(this,this.onMessage);this.ws.onclose=Bridge.fn.bind(this,this.onClose);this.ws.onerror=Bridge.fn.bind(this,this.onError)},onError:function(){window.alert("Error")},onClose:function(){},onMessage:function(arg){var evt=Bridge.merge(new System.Windows.Forms.WSEventArgs,JSON.parse(arg.data.toString())),form,parent;switch(evt.eventType){case"MessageBox":window.alert(evt.value.toString());break;case"PropertyChanged":case"addListViewItem":case"addListItem":case"removeListViewItem":case"removeListItem":case"addListViewColumn":case"removeListViewColumn":case"clearList":break;case"removeControl":break;case"addControl":break;case"FormCreate":form=Bridge.merge(new System.Windows.Forms.Form,JSON.parse(JSON.stringify(evt.value)));form.setClientId(evt.clientId);parent=form.getParent();Bridge.hasValue(parent)||(Bridge.hasValue(this.root)||(this.root=form),window.onresize=Bridge.fn.bind(this,this.onResize),document.title=form.getText(),document.body.appendChild(form.element));this.addOrUpdate(form);form.showDialog();break;default:window.alert("Unknown message type:"+evt.eventType)}},onResize:function(e){e===void 0&&(e=null);this.controls.clear();this.root.element.innerHTML="";this.root.showDialog()},addOrUpdate:function(ctrl){!Bridge.String.isNullOrEmpty(ctrl.getParentId())&&this.controls.containsKey(ctrl.getParentId())&&ctrl.setParent(this.controls.get(ctrl.getParentId()));this.controls.containsKey(ctrl.getClientId())?this.controls.set(ctrl.getClientId(),ctrl):this.controls.add(ctrl.getClientId(),ctrl)},onSocketOpen:function(){var args=new System.Windows.Forms.WSEventArgs;args.eventType="openForm";this.send(args)},send:function(o){var msg=JSON.stringify(o);this.ws.send(msg)}});Bridge.init()})(this);